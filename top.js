var _Mathfloor=Math.floor,_Mathmax=Math.max,_Mathround=Math.round,_app={days:['Mon','Tue','Wed','Thu','Fri','Sat','Sun'],areas:['V\xF9ng 1','V\xF9ng 2','V\xF9ng 3','V\xF9ng 4','V\xF9ng 5','V\xF9ng 6','V\xF9ng 7'],boxes:[611584,407100,420900,616400,763147,808876,415681],apps:['Thi\u1EBFu nhi','Gi\u1EA3i tr\xED','Phim truy\u1EC7n','N\xEAn xem','Th\u1EC3 thao'],colors:['#F7FCF0','#E0F3DB','#CCEBC5','#A8DDB5','#BBF3FF','#A1D9FF','#87BFFF','#6EA6E7','#558DCE']};_app.byDayOfWeek={init:function(e){var k=dc.rowChart('#by-day-of-week-chart'),l=crossfilter(e),n=l.dimension(function(t){return t.day}),o=n.group().reduceSum(function(t){return t.pageviews}),p=d3.min(e,function(t){return t.pageviews}),q=d3.max(e,function(t){return t.pageviews}),r=d3.scale.linear().domain([p,q]).range([0,e.length]),s=d3.scale.ordinal().domain(d3.range(e.length)).range(_app.colors.slice(-e.length));k.width(240).height(240).margins({top:10,left:5,right:5,bottom:30}).dimension(n).group(o).colors(s).colorAccessor(function(t){return _Mathround(r(t.value))}),k.xAxis().ticks(5),k.render(),function(t,u){t.svg().append('text').attr('class','x-axis-label').attr('text-anchor','middle').attr('x',t.width()/2).attr('y',t.height()).text(u)}(k)},data:function(e){e=e||[],this.init(e)}},_app.byArea={init:function(e){var k=dc.rowChart('#by-area-chart'),l=crossfilter(e),n=l.dimension(function(t){return t.area}),o=n.group().reduceSum(function(t){return t.pageviews}),p=d3.min(e,function(t){return t.pageviews}),q=d3.max(e,function(t){return t.pageviews}),r=d3.scale.linear().domain([p,q]).range([0,e.length]),s=d3.scale.ordinal().domain(d3.range(e.length)).range(_app.colors.slice(-e.length));k.width(240).height(240).margins({top:10,left:5,right:5,bottom:30}).dimension(n).group(o).colors(s).colorAccessor(function(t){return _Mathround(r(t.value))}),k.xAxis().ticks(5),k.render(),function(t,u){t.svg().append('text').attr('class','x-axis-label').attr('text-anchor','middle').attr('x',t.width()/2).attr('y',t.height()).text(u)}(k)},data:function(e){e=e||[],this.init(e)}},_app.byApp={init:function(e){var f=dc.pieChart('#by-app-chart'),k=crossfilter(e),l=k.dimension(function(p){return p.app}),n=l.group().reduceSum(function(p){return p.pageviews}),o=d3.scale.ordinal().domain([0,e.length]).range(['#E5F5E0','#E0F3DB','#FDAE6B','#E5D8BD','#BBF3FF','#A1D9FF','#87BFFF','#FDDAEC','#558DCE']);f.width(180).height(240).slicesCap(5).innerRadius(40).dimension(l).group(n).renderTitle(!0).legend(dc.legend().x(0).y(0)).colors(o),f.onClick=function(p){var t=d3.range(p.value).map(function(){var u=d3.random.normal(1,2);return _Mathmax(1,_Mathround(u()))});_app.pageDistHistogram.data(p,t)},f.filter=function(){},f.render(),0<e.length&&f.onClick({key:e[0].app,value:e[0].pageviews})},data:function(e){e=e||[],this.init(e)}},_app.movieMetrics=function(e){var f=_app.cumulatives.get(e.toString()),k=f.title;$('#movie-metrics').html(k);for(var l=f.cupv,n=[],o=0,p=_Mathfloor(Math.random()*_app.days.length),q=0;q<_app.days.length;q++)if(q!=p){var r=_Mathfloor(l/_app.days.length+Math.random()*l/(3*_app.days.length)*(Math.random()-1));n.push({day:_app.days[q],pageviews:r}),o+=r}n.push({day:_app.days[p],pageviews:l-o}),_app.byDayOfWeek.data(n);var s=[];o=0,p=_Mathfloor(Math.random()*_app.areas.length);for(var q=0;q<_app.areas.length;q++)if(q!=p){var r=_Mathfloor(l/_app.areas.length+Math.random()*l/(3*_app.areas.length)*(Math.random()-1));s.push({area:_app.areas[q],pageviews:r,boxes:_app.boxes[q],id:q+1,name:'V\xF9ng '+(q+1)}),o+=r}s.push({boxes:_app.boxes[p],area:_app.areas[p],pageviews:l-o,id:p+1,name:'V\xF9ng '+(p+1)}),_app.byArea.data(s),_app.map.data(s);var t=[];o=0,p=_Mathfloor(Math.random()*_app.apps.length);for(var q=0;q<_app.apps.length;q++)if(q!=p){var r=_Mathfloor(l/_app.apps.length+Math.random()*l/(3*_app.apps.length)*(Math.random()-1));t.push({app:_app.apps[q],pageviews:r}),o+=r}t.push({app:_app.apps[p],pageviews:l-o}),_app.byApp.data(t)},_app.pageDistHistogram={init:function(e,f){var k=dc.barChart('#app-page-dist-chart');d3.select('#app-name').html(e.key);var l=crossfilter(f),n=l.dimension(function(p){return p}),o=n.group().reduceCount();k.width(240).height(240).margins({top:10,left:50,right:5,bottom:30}).brushOn(!1).dimension(n).group(o).x(d3.scale.linear().domain([0,d3.max(f)])),k.xAxis().ticks(5),k.yAxis().ticks(10).tickFormat(d3.format(',')),k.render()},data:function(e,f){e=e||{key:''},f=f||[],this.init(e,f)}},_app.map={data:function(e){var f=d3.select('.map-scatterplot svg');f.remove(),this.scatterplot(e)},legend:function(){var e=d3.select('.legend-container');e.html('<h1>Density</h1><div class="index-level-bar"><div class="bar-legend"></div><div class="bar-label">Lower denisty</div><div class="bar-label second">Higher denisty</div><div style="clear: both;"></div></div>');var f=d3.select('.bar-legend').append('svg').attr('width',240).attr('height',12);f.selectAll('rect').data(d3.range(7).map(function(k){return'q'+(k+3)+'-9'})).enter().append('rect').attr('width',240/7).attr('height',12).attr('x',function(k,l){return 240/7*l}).attr('data-level',function(k,l){return l+3}).attr('class',function(k){return'legend '+k}).on('mouseover',function(){d3.selectAll('.legend').style('opacity',.3),d3.select(this).style('opacity',1);var l=d3.select(this).attr('data-level');d3.selectAll('.area-feature').style('opacity',.1).filter('.q'+l+'-9').style('opacity',1),d3.selectAll('.bubble').style('fill-opacity',.1).filter('.q'+l+'-9').style('fill-opacity',.75),d3.selectAll('.state-boundary').style('stroke-opacity',.3)}).on('mouseout',function(){d3.selectAll('.legend').style('opacity',1),d3.selectAll('.area-feature').style('opacity',1),d3.selectAll('.bubble').style('fill-opacity',.75),d3.selectAll('.area-boundary').style('stroke-opacity',1)})},scatterplot:function(e){e=e||[];var f={top:20,right:10,bottom:80,left:40},k=300-f.left-f.right,l=300-f.top-f.bottom,n=d3.select('.map-scatterplot').append('svg').attr('width',k+f.left+f.right).attr('height',l+f.top+f.bottom).append('g').attr('transform','translate('+f.left+','+f.top+')'),o=d3.scale.linear().domain([d3.min(e,function(E){return E.pageviews}),d3.max(e,function(E){return E.pageviews})]).range([0,k]),p=d3.scale.linear().domain([d3.min(e,function(E){return E.boxes/1e3}),d3.max(e,function(E){return E.boxes/1e3})]).range([l,0]),q=d3.min(e,function(E){return E.pageviews/E.boxes}),r=d3.max(e,function(E){return E.pageviews/E.boxes}),s=d3.scale.sqrt().domain([q,r]).range([5,12]),t=d3.svg.axis().scale(o).orient('bottom').ticks(8).tickSize(-l).tickFormat(d3.format('s')),u=d3.svg.axis().scale(p).orient('left').ticks(8).tickSize(-k);n.append('g').attr('class','x-axis axis').attr('transform','translate(0,'+l+')').call(t),n.append('g').attr('class','y-axis axis').attr('transform','translate(0,0)').call(u),n.append('text').attr('class','x label').attr('text-anchor','middle').attr('x',k-k/2).attr('y',l+f.bottom/2).text('Pageviews'),n.append('text').attr('class','y label').attr('text-anchor','middle').attr('y',-f.left+5).attr('x',0-l/2).attr('dy','1em').attr('transform','rotate(-90)').text('S\u1ED1 l\u01B0\u1EE3ng box');var z=d3.scale.category20(),A=d3.scale.linear().domain([q,r]).range([0,e.length]),B=d3.scale.ordinal().domain(d3.range(e.length)).range(_app.colors.slice(-e.length));e.forEach(function(E){var F=_Mathround(A(E.pageviews/E.boxes))+3;F=8<F?8:F;var G='q'+F+'-9';d3.select('.area-'+E.id+' .area-feature').attr('class','area-feature '+G)});var C=d3.select('.area-tooltip'),D=n.selectAll('circle').data(e).enter().append('circle').attr('cx',function(E){return o(E.pageviews)}).attr('cy',function(E){return p(E.boxes/1e3)}).attr('r',function(E){return s(1*E.pageviews/E.boxes)}).attr('class',function(E){var F=_Mathround(A(E.pageviews/E.boxes))+3;return F=8<F?8:F,'bubble area-'+E.id+' q'+F+'-9'}).on('mouseover',function(E){C.transition().duration(300).style('opacity',1),C.text(E.name).style('left',d3.event.pageX+'px').style('top',d3.event.pageY-50+'px')}).on('mouseout',function(){C.transition().duration(300).style('opacity',0)})},init:function(){function e(F,G){D=d3.geo.mercator().translate([p/2,q/2-50]).scale([2e3]).center([106.34899620666437,16.553160650957434]),B=d3.geo.path().projection(D),C=d3.behavior.zoom().translate([0,0]).scale(1).scaleExtent([1,13]).on('zoom',k),z=d3.select('#map-canvas').append('svg').attr('width',p).attr('height',q).on('click',l,!0),z.append('rect').attr('class','overlay').attr('width',p).attr('height',q).on('click',function(){s=1,t=[0,0],n()},!0),A=z.append('g'),z.call(C).call(C.event).on('dblclick.zoom',null);var K=A.append('g').attr('class','boundary'),L=G.map(function(P){return P.properties.business_area});L=L.filter((P,Q,R)=>R.indexOf(P)==Q);for(var O,M=[],N=0;N<L.length;N++)O=topojson.merge(F,F.objects.states.geometries.filter(function(P){return P.properties.business_area==L[N]})),M.push({geometry:O,properties:{area:L[N]},type:'Feature'});A.append('g').attr('class','business-areas').selectAll('path').data(M).enter().append('g').attr('class',function(P){return'area area-'+P.properties.area}).on('mouseover',function(P){E.transition().duration(300).style('opacity',1),E.text('V\xF9ng '+P.properties.area).style('left',d3.event.pageX+'px').style('top',d3.event.pageY-50+'px')}).on('mouseout',function(){E.transition().duration(300).style('opacity',0)}).append('path').attr('class','area-feature').attr('d',B),K.append('path').attr('class','country-boundary').datum(topojson.merge(F,F.objects.states.geometries)).attr('d',B),K.append('path').attr('class','state-boundary').datum(topojson.mesh(F,F.objects.states,function(P,Q){return P!==Q})).attr('d',B),K.append('path').attr('class','area-boundary').datum(topojson.mesh(F,F.objects.states,function(P,Q){return P.properties.business_area!==Q.properties.business_area})).attr('d',B),f(),d3.select(self.frameElement).style('height',q+'px')}function f(){A.append('g').attr('class','cities'),d3.csv('vn-cities.csv',function(F,G){return F?console.warn(F):void G.forEach(function(H){var J=A.selectAll('.cities').append('g').datum(H).attr('class',function(K){return'city city-'+K.code+' level-'+K.level});J.append('circle').attr('class',function(){return'city-place'}).attr('visibility',function(K){return 2>K.level?'visible':'hidden'}).attr('cx',function(K){return D([K.lng,K.lat])[0]}).attr('cy',function(K){return D([K.lng,K.lat])[1]}).attr('r',2).style('fill','white').style('stroke','black').style('stroke-width',1).style('opacity',0.85).on('mouseover',function(){}).on('mouseout',function(){}),J.append('text').attr('class',function(){return'city-label'}).text(function(K){return K.name}).attr('visibility',function(K){return 2>K.level?'visible':'hidden'}).attr('x',function(K){return D([K.lng,K.lat])[0]}).attr('y',function(K){return D([K.lng,K.lat])[1]}).attr('text-anchor',function(K){return 105.7<K.lng?'start':'end'}).attr('dx',function(K){return 0.7*(105.7<K.lng?1:-1)+'em'}).attr('dy','.35em')})})}function k(){A.selectAll('.country-boundary').style('stroke-width',1/d3.event.scale+'px'),A.selectAll('.feature').style('stroke-width',2/(d3.event.scale+0.5)+'px'),A.attr('transform','translate('+d3.event.translate+')scale('+d3.event.scale+')'),A.selectAll('.state-label').style('font-size',8/d3.event.scale+2+'px'),A.selectAll('.city-place').style('r',1/d3.event.scale+0.7).style('stroke-width',2/(d3.event.scale+0.5)+'px'),A.selectAll('.city-label').style('font-size',11/d3.event.scale+1.5+'px').attr('dy',1==d3.event.scale?'0.35em':0.35*(1/d3.event.scale)+0.2+'em'),A.selectAll('.level-3 .city-label').style('font-size',6/d3.event.scale+1.5+'px'),A.selectAll('.level-4 .city-label').style('font-size',5/d3.event.scale+1.5+'px'),2>d3.event.scale?(A.selectAll('.level-2 .city-label').attr('visibility','hidden'),A.selectAll('.level-2 .city-place').attr('visibility','hidden')):(A.selectAll('.level-2 .city-label').attr('visibility','visible'),A.selectAll('.level-2 .city-place').attr('visibility','visible')),3.3>d3.event.scale?(A.selectAll('.level-3 .city-label').attr('visibility','hidden'),A.selectAll('.level-3 .city-place').attr('visibility','hidden'),A.selectAll('.level-4 .city-label').attr('visibility','hidden'),A.selectAll('.level-4 .city-place').attr('visibility','hidden')):(A.selectAll('.level-3 .city-label').attr('visibility','visible'),A.selectAll('.level-3 .city-place').attr('visibility','visible'),A.selectAll('.level-4 .city-label').attr('visibility','visible'),A.selectAll('.level-4 .city-place').attr('visibility','visible'))}function l(){d3.event.defaultPrevented&&d3.event.stopPropagation()}function n(){r.classed('active',!1),r=d3.select(null),s=s||1,t=t||[0,0],z.transition().duration(750).call(C.translate(t).scale(s).event)}var p=660,q=700,r=d3.select(null),s,t,u=d3.scale.quantile().range(d3.range(9).map(function(F){return'q'+F+'-9'})),z,A,B,C,D,E;d3.select('#loading').classed('hidden',!1),E=d3.select('body').append('div').attr('class','area-tooltip').style('opacity',0).on('click',l,!0),d3.json('https://cdn.jsdelivr.net/gh/kierandg/kierandg.github.io@master/vn-states.json',function(F,G){if(F)return console.warn(F);d3.select('#loading').classed('hidden',!0);var H=topojson.feature(G,G.objects.states).features;e(G,H),_app.map.scatterplot(),_app.map.legend()})}};function dataTable(e){e.forEach(function(l){var n='<tr data-id="'+l.id+'" data-title="'+l.title+'">';n+='<td class="center"></td>',n+='<td>'+l.title+'</td>',n+='<td class="minimize">'+l.cupv+'</td>',n+='<td class="minimize">'+l.cply+'</td>',n+='</tr>',$('#movies-table tbody').append(n)});var f=$('#movies-table').DataTable({language:{info:'Trang _PAGE_/_PAGES_',infoEmpty:'Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u',zeroRecords:'Kh\xF4ng t\xECm th\u1EA5y',lengthMenu:'Hi\u1EC3n th\u1ECB _MENU_ d\xF2ng m\u1ED9t trang',paginate:{first:'\u0110\u1EA7u',last:'Cu\u1ED1i',next:'Ti\u1EBFp',previous:'Tr\u01B0\u1EDBc'},search:'T\xECm'},columnDefs:[{targets:[0],class:'center',sortable:!1,searchable:!1}],order:[[1,'asc']]});$('.dataTable thead th').each(function(l,n){var o=$(n).html();$(n).html(o+'<i class="icon-caret fa fa-caret-up"></i><i class="icon-caret fa fa-caret-down"></i>')}),f.on('draw.dt',function(){f.column(0).nodes().each(function(l,n){l.innerHTML=n+1})}).draw(),$('#movies-table tbody').on('click','tr',function(){$(this).hasClass('selected')?$(this).removeClass('selected'):(f.$('tr.selected').removeClass('selected'),$(this).addClass('selected'));var l=f.$('tr.selected').data('id');_app.movieMetrics(l)}),$('.table-responsive').on('show.bs.dropdown',function(){$('.table-responsive').css('overflow','inherit')}),$('.table-responsive').on('hide.bs.dropdown',function(){$('.table-responsive').css('overflow','auto')})}_app.cumulativeChart=function(){function e(G){var H=G.map(function(I){if(I.visible)return d3.max(I.dates,function(J){return J.cupv})});return d3.max(H)}var f={top:20,right:580,bottom:115,left:50},k={top:430,right:10,bottom:30,left:40},l=1280-f.left-f.right,n=500-f.top-f.bottom,o=500-k.top-k.bottom,p=d3.bisector(function(G){return G.date}).left,q=d3.scale.category20(),r=d3.time.scale().range([0,l]),s=d3.time.scale().range([0,l]),t=d3.scale.linear().range([n,0]),u=d3.svg.axis().scale(r).ticks(d3.time.day,2).orient('bottom'),z=d3.svg.axis().scale(s).ticks(d3.time.day,2).orient('bottom'),A=d3.svg.axis().scale(t).orient('left'),B=d3.svg.line().interpolate('basis').x(function(G){return r(G.date)}).y(function(G){return t(G.cupv)}).defined(function(G){return G.cupv}),D=d3.select('.cumulative-chart').append('svg').attr('width',l+f.left+f.right).attr('height',n+f.top+f.bottom).append('g').attr('transform','translate('+f.left+','+f.top+')');D.append('rect').attr('width',l).attr('height',n).attr('x',0).attr('y',0).attr('id','mouse-tracker').style('fill','white');var E=D.append('g').attr('transform','translate(0,410)').attr('class','context'),F=function(G){G.selectAll('text').style('text-anchor','end').attr('dx','-.8em').attr('dy','.15em').attr('transform','rotate(-25)')};D.append('defs').append('clipPath').attr('id','clip').append('rect').attr('width',l).attr('height',n),d3.csv('data.csv',function(G,H){H.forEach(function(fa){var ga=fa.date.split('-');fa.date=new Date(ga[0],ga[1]-1,ga[2]),fa.cupv=parseInt(fa.cupv),fa.upv=parseInt(fa.upv),fa.cply=parseInt(fa.cply),fa.ply=parseInt(fa.ply)}),_app.cumulatives=H.reduce(function(fa,ga){var ha=fa.get(ga.id)||{id:ga.id,title:ga.title,cupv:0,cply:0},ia=ga.cupv>ha.cupv?parseInt(ga.cupv):ha.cupv,ja=ga.cply>ha.cply?parseInt(ga.cply):ha.cply;return fa.set(ga.id,{id:ga.id,title:ga.title,cupv:ia,cply:ja}),fa},new Map);var L=Array.from(_app.cumulatives.values());L.sort(function(fa,ga){return fa.cupv-ga.cupv}),dataTable(_app.cumulatives);var M=d3.extent(H,function(fa){return fa.date});r.domain(M);var N=L.slice(-20).map(function(fa){return fa.id});N=N.filter((fa,ga,ha)=>ha.indexOf(fa)==ga),q.domain(N);var O=H.reduce(function(fa,ga){var ha=fa.get(ga.id)||{id:ga.id,name:ga.title,dates:new Map,visible:-1!=N.slice(-3).indexOf(ga.id)};return ha.dates.set(ga.date.toDateString(),ga),fa.set(ga.id,ha),fa},new Map);O.forEach(function(fa){fa.dates=Array.from(fa.dates.values()),fa.dates.sort(function(ga,ha){return ga.date-ha.date})});var P=N.map(function(fa){return O.get(fa)}),Q=d3.max(P,function(fa){return d3.max(fa.dates,function(ga){return ga.cupv})});t.domain([0,Q]),s.domain(r.domain());var R=d3.svg.brush().x(s).on('brush',function(){if(R.empty())r.domain(s.domain());else{var fa=R.extent();fa[0]=d3.time.day.floor(fa[0]),fa[1]=d3.time.day.ceil(fa[1]),r.domain(fa)}var ga=D.select('.x.axis').transition().call(u);F(ga),Q=e(P),t.domain([0,Q]),D.select('.y.axis').transition().call(A),Z.select('path').transition().attr('d',function(ha){return ha.visible?B(ha.dates):null})}).on('brushend',function(){if(d3.event.sourceEvent&&!R.empty()){var fa=R.extent(),ga=fa.map(d3.time.day.round);ga[0]>=ga[1]&&(ga[0]=d3.time.day.floor(d0[0]),ga[1]=d3.time.day.offset(ga[0])),d3.select(this).transition().call(R.extent(ga)).call(R.event)}}),S=E.append('g').attr('class','x axis1').attr('transform','translate(0,'+o+')').call(z);F(S);var T=d3.svg.area().interpolate('monotone').x(function(fa){return s(fa)}).y0(o).y1(0),U=d3.time.scale().domain(M).ticks(d3.time.day,1);E.append('path').attr('class','area').attr('d',T(U)).attr('fill','#F1F1F2');var V=d3.scale.linear().range([o,0]);V.domain([0,Q]);var W=d3.svg.line().x(function(fa){return s(fa.date)}).y(function(fa){return V(fa.cupv)}).defined(function(fa){return fa.cupv}),X=E.append('g').attr('class','mini-group').selectAll('.mini').data(P).enter().append('g').attr('class','mini');X.append('path').attr('class','line').style('pointer-events','none').attr('id',function(fa){return'line-'+fa.id.replace(' ','').replace('/','')}).attr('d',function(fa){return fa.visible?W(fa.dates):null}).attr('clip-path','url(#clip)').style('stroke',function(fa){return q(fa.id)}),E.append('g').attr('class','x brush').call(R).selectAll('rect').attr('height',o).attr('fill','#E6E7E8');var Y=D.append('g').attr('class','x axis').attr('transform','translate(0,'+n+')').call(u);F(Y),D.append('g').attr('class','y axis').call(A).append('text').attr('transform','rotate(-90)').attr('y',6).attr('x',-10).attr('dy','.71em').style('text-anchor','end');var Z=D.selectAll('.movie').data(P).enter().append('g').attr('class','movie');Z.append('path').attr('class','line').style('pointer-events','none').attr('id',function(fa){return'line-'+fa.id.replace(' ','').replace('/','')}).attr('d',function(fa){return fa.visible?B(fa.dates):null}).attr('clip-path','url(#clip)').style('stroke',function(fa){return q(fa.id)});var _=450/P.length;Z.append('rect').attr('width',10).attr('height',10).attr('x',l+f.right/6-15).attr('y',function(fa,ga){return _+ga*_-8}).attr('fill',function(fa){return fa.visible?q(fa.id):'#F1F1F2'}).attr('class','legend-box').on('click',function(fa){fa.visible=!fa.visible,Q=e(P),t.domain([0,Q]),V.domain([0,Q]),D.select('.y.axis').transition().call(A),Z.select('path').transition().attr('d',function(ga){return ga.visible?B(ga.dates):null}),Z.select('rect').transition().attr('fill',function(ga){return ga.visible?q(ga.id):'#F1F1F2'}),X.select('path').transition().attr('d',function(ga){return ga.visible?W(ga.dates):null})}).on('mouseover',function(fa){d3.select(this).transition().attr('fill',function(ga){return q(ga.id)}),d3.select('#line-'+fa.id.replace(' ','').replace('/','')).transition().style('stroke-width',2.5)}).on('mouseout',function(fa){d3.select(this).transition().attr('fill',function(ga){return ga.visible?q(ga.id):'#F1F1F2'}),d3.select('#line-'+fa.id.replace(' ','').replace('/','')).transition().style('stroke-width',1.5)}),Z.append('text').attr('x',l+f.right/6).attr('y',function(fa,ga){return _+ga*_}).text(function(fa){return fa.name});var aa=D.append('g').attr('class','hover-group'),ba=aa.append('line').attr('id','hover-line').attr('class','x-tracking').attr('x1',10).attr('x2',10).attr('y1',0).attr('y2',n+6).style('pointer-events','none').style('opacity',1e-6),ca=aa.append('text').attr('class','hover-text').attr('y',n-(n-40)).attr('x',l-150).style('fill','#E6E7E8'),da=P.map(function(fa){return fa.id}),ea=Z.select('g').data(da).enter().append('g').attr('class','focus');ea.append('text').attr('class','movie-tooltip y-tracking').attr('x',l+20).attr('y',function(fa,ga){return _+ga*_}),d3.select('#mouse-tracker').on('mousemove',function(){var fa=d3.mouse(this)[0],ga=r.invert(fa),ha=d3.time.format('%a %d %b');ca.text(ha(ga)),d3.select('#hover-line').attr('x1',fa).attr('x2',fa).style('opacity',1);var ia=r.invert(d3.mouse(this)[0]),ja=d3.time.day.floor(ia),ka=d3.time.day.ceil(ia),la=ia-ja>ka-ia?ka:ja;ea.select('text').text(function(ma){var na=O.get(ma).dates,oa=na.filter(function(pa){return pa.date.getTime()==la.getTime()});return 0<oa.length?d3.format(',')(oa[0].cupv):null})}).on('mouseout',function(){ca.text(null),d3.select('#hover-line').style('opacity',1e-6)})})};
